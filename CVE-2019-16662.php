
<?php
header('Content-Type: application/json');

$rootUname = filter_input(INPUT_POST, 'rootUname', FILTER_SANITIZE_STRING);
$array = array();

// Validate rootUname (e.g., allow only alphanumeric characters)
if (preg_match('/^[a-zA-Z0-9]+$/', $rootUname)) {
    // Check PHP Safe_Mode is off
    if (ini_get('safe_mode')) {
        $array['phpSafeMode'] = 'Error - Server settings are not compatible.';
    } else {
        $array['phpSafeMode'] = 'Pass - Server settings are compatible.';
    }

    // Test root account details (use a safer method)
    $valid_root_details = verify_root_account_details($rootUname);

    if ($valid_root_details) {
        $array['rootDetails'] = 'Pass - root account details are good.';
    } else {
        $array['rootDetails'] = 'Error - Invalid root account details.';
    }
} else {
    $array['rootDetails'] = 'Error - Invalid input.';
}

echo json_encode($array);

// A safer method to verify the root account details without using shell_exec()
function verify_root_account_details($rootUname) {
    // Implement the logic here to verify root account details safely
    // Example: Check against a list of allowed root account usernames from a configuration file or a database

    $allowed_root_usernames = array("root", "admin", "superuser");
    if (in_array($rootUname, $allowed_root_usernames)) {
        return true;
    } else {
        return false;
    }
}
